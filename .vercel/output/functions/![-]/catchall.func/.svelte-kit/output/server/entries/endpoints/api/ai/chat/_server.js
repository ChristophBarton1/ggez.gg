import{json as e}from"@sveltejs/kit";async function n({request:n}){try{const{messages:i,match:s,participant:t}=await n.json();if(!i||0===i.length)return e({error:"No messages provided"},{status:400});const a=i.filter(e=>"user"===e.role).pop();if(!a)return e({error:"No user message found"},{status:400});const o=await async function(e,n,i){const s=e.toLowerCase();return s.includes("build")||s.includes("item")?function(e){const n=[e.item0,e.item1,e.item2,e.item3,e.item4,e.item5,e.item6].filter(e=>0!==e),i=[];return i.push(`üìä **Build Analysis for ${e.championName}**\n\n`),i.push(`**Your Items:** ${n.length>0?"Item IDs: "+n.join(", "):"No items"}\n\n`),i.push("**General Build Tips:**\n"),i.push("‚Ä¢ Build **Grievous Wounds** against healing (Morellonomicon, Thornmail, Chempunk Chainsword)\n"),i.push("‚Ä¢ Buy **Magic Resist** when enemy has 3+ AP champions\n"),i.push("‚Ä¢ Complete **Mythic item first** (usually best power spike)\n"),i.push("‚Ä¢ **Situational items** > Meta builds when needed\n\n"),i.push(`üí° **${e.championName} Build Priority:**\n`),i.push("1. Check current meta on u.gg or lolalytics\n"),i.push("2. Adapt to enemy team comp\n"),i.push("3. Consider your team's needs (tank, damage, utility)\n\n"),i.push("*Detailed item-by-item analysis coming soon with full item names and recommendations!*"),i.join("")}(i):s.includes("mistake")||s.includes("wrong")||s.includes("bad")?function(e,n){const i=[];i.push("üéØ **Key Mistakes Analysis**\n\n");const s=[];e.deaths>=7?s.push({severity:"Critical",mistake:`Too Many Deaths (${e.deaths})`,why:"Each death gives enemy gold AND removes you from the map for 20-60 seconds. That's missed CS, XP, and objectives.",fix:'Before engaging, always ask: "Where is their team?" Use /mute all if teammates tilt you into bad fights.'}):e.deaths>=5&&s.push({severity:"Medium",mistake:`Death Count Could Be Lower (${e.deaths})`,why:"Pro players average 2-4 deaths per game. Each death is a mistake you can avoid.",fix:"Review your deaths: Were you too aggressive? Out of position? Missing vision? Fix one pattern at a time."});const t=n.info.gameDuration/60,a=(e.totalMinionsKilled+e.neutralMinionsKilled)/t;a<5.5&&s.push({severity:"High",mistake:`Low CS/min (${a.toFixed(1)})`,why:"Every 15 CS = 1 kill in gold. You're leaving hundreds of gold on the map.",fix:"Practice last-hitting in Practice Tool. Don't miss CS while poking. Catch side waves after laning phase."}),e.visionScore<1.5*t&&s.push({severity:"Medium",mistake:`Insufficient Vision (${e.visionScore} score)`,why:"Vision wins games. You can't make good decisions without information.",fix:"Buy 2 Control Wards EVERY back. Place wards before objectives. Clear enemy wards before Baron/Dragon."});const o=n.info.participants.filter(n=>n.teamId===e.teamId).reduce((e,n)=>e+n.kills,0),r=o>0?(e.kills+e.assists)/o*100:0;return r<50&&s.push({severity:"Medium",mistake:`Low Kill Participation (${r.toFixed(0)}%)`,why:"You're not involved in enough fights. Either you're farming while team fights, or positioning poorly.",fix:"Watch minimap every 3 seconds. Ping when you can't join fights. Position better in teamfights to get assists."}),s.length>0?s.forEach(e=>{i.push(`**${e.severity}: ${e.mistake}**\n`),i.push(`‚ùì Why it matters: ${e.why}\n`),i.push(`‚úÖ How to fix: ${e.fix}\n\n`)}):(i.push("‚úÖ No major mistakes detected! You played a clean game.\n\n"),i.push("Small optimizations:\n"),i.push("‚Ä¢ Watch replays to spot minor positioning errors\n"),i.push("‚Ä¢ Track your CS at 10/20 mins (goal: 80/160+)\n"),i.push("‚Ä¢ Note your deaths and why they happened\n")),i.join("")}(i,n):s.includes("pro")||s.includes("tip")||s.includes("advice")?function(e){const n=[];n.push(`üéØ **Pro Tips for ${e.championName}**\n\n`);const i=e.teamPosition||e.individualPosition;return n.push(`**${i} Role Mastery:**\n`),"JUNGLE"===i?(n.push("‚Ä¢ **Pathing**: Plan your route to end near next objective (Dragon/Herald)\n"),n.push("‚Ä¢ **Tracking**: Know enemy jungler position by their camps/ganks\n"),n.push("‚Ä¢ **Pressure**: Gank losing lanes less, winning lanes more (snowball!)\n"),n.push("‚Ä¢ **Vision**: Place wards at enemy jungle entrances before objectives\n\n")):"SUPPORT"===i?(n.push("‚Ä¢ **Roaming**: Leave ADC at 6-8 mins to impact mid/jungle\n"),n.push("‚Ä¢ **Vision**: Control Wards in pixel bush & river\n"),n.push("‚Ä¢ **Engage**: Don't force fights when your ADC is weak\n"),n.push("‚Ä¢ **Peel**: Know when to engage vs peel for carries\n\n")):"MIDDLE"===i?(n.push("‚Ä¢ **Wave**: Always push before roaming (deny CS & XP)\n"),n.push("‚Ä¢ **Roaming**: Ping 3x before roaming so team expects you\n"),n.push("‚Ä¢ **Priority**: Get lane prio to help jungle at Scuttle\n"),n.push("‚Ä¢ **Assassins**: If behind, farm and catch waves, don't force fights\n\n")):"BOTTOM"===i?(n.push("‚Ä¢ **Trading**: Auto attack after enemy uses spell (trade stance)\n"),n.push("‚Ä¢ **Positioning**: Stay in max range, kite back in teamfights\n"),n.push("‚Ä¢ **Farming**: Practice perfect CS, it's your #1 job\n"),n.push("‚Ä¢ **Scaling**: Play safe early, you outscale most champs\n\n")):"TOP"===i&&(n.push("‚Ä¢ **Wave**: Freeze when ahead, push when behind (recall safety)\n"),n.push("‚Ä¢ **TP**: Save TP for drake fights (4v4/5v5 > 1 kill top)\n"),n.push("‚Ä¢ **Split**: When strong, split push and draw 2+ enemies\n"),n.push("‚Ä¢ **Tanks**: If tank, peel carries > engaging in teamfights\n\n")),n.push("**Universal Pro Tactics:**\n"),n.push("‚Ä¢ Die **3 times or less** per game = Challenger mindset\n"),n.push("‚Ä¢ **Watch minimap every 3 seconds** (set timer if needed)\n"),n.push("‚Ä¢ **Mute all** (/mute all) if you tilt from chat\n"),n.push("‚Ä¢ **Dodge** games with trolls in champ select (lose 3 LP > 20)\n"),n.push("‚Ä¢ **One-trick** 2-3 champions to climb faster\n\n"),n.push(`üí° Want champion-specific combos and tricks? Ask me: *"How do pros play ${e.championName}?"*`),n.join("")}(i):s.includes("similar")||s.includes("pro player")||s.includes("compare")?`üîç **Pro Player Comparison**\n\nI'm analyzing how professional players perform on ${i.championName}...\n\n*This feature is coming soon! It will show:*\n‚Ä¢ Similar games from Challenger/Pro players\n‚Ä¢ Build comparisons\n‚Ä¢ Playstyle differences\n‚Ä¢ What they do differently\n\nFor now, check out:\n‚Ä¢ op.gg/champions/${i.championName}/statistics\n‚Ä¢ u.gg/${i.championName}/build`:s.includes("how to play")||s.includes("champion")?function(e){const n=e.championName;return`üìñ **How to Play ${n}**\n\n**Power Spikes:**\n‚Ä¢ Level 2-3 (skill combo unlocked)\n‚Ä¢ Level 6 (ultimate)\n‚Ä¢ First item completion\n‚Ä¢ Level 11 & 16 (ultimate upgrades)\n\n**Win Condition:**\n‚Ä¢ Early Game: Farm safely, avoid deaths\n‚Ä¢ Mid Game: Rotate for objectives with team\n‚Ä¢ Late Game: Position perfectly in teamfights\n\n**Common Mistakes:**\n‚Ä¢ Using ultimate at wrong time\n‚Ä¢ Overextending without vision\n‚Ä¢ Not respecting enemy power spikes\n\n*Detailed ${n} guide with combos & matchups coming soon!*\n\nFor now, check: **u.gg/${n}** for builds & stats`}(i):s.includes("rank")||s.includes("climb")||s.includes("improve")?function(e,n){const i=n.info.gameDuration/60,s=(e.totalMinionsKilled+e.neutralMinionsKilled)/i;return`‚¨ÜÔ∏è **How to Climb Faster**\n\n**#1 Priority: Die Less**\nYour deaths: ${e.deaths}\nGoal: 0-3 deaths per game\nEach death = -300g for enemy, -20-60s off map for you\n\n**#2 Priority: Farm Better**\nYour CS/min: ${s.toFixed(1)}\nGoal: 7+ CS/min\n10 CS = 1 kill = faster items = more carry potential\n\n**#3 Priority: One-Trick 2-3 Champs**\nMaster mechanics ‚Üí Focus on macro\nLearn matchups deeply\n50+ games on one champ = muscle memory\n\n**#4: Mental Game**\n‚Ä¢ /mute all every game (no exceptions)\n‚Ä¢ Take 10min break after loss\n‚Ä¢ Stop at 2 losses in a row\n‚Ä¢ Focus on YOUR play, not team\n\n**Fastest Climb Formula:**\n1. One-trick ${e.championName}\n2. Die max 3 times per game\n3. Farm 7+ CS/min\n4. Play 5 games/day, review 1 loss\n\nDo this for 30 days = guaranteed climb! üí™`}(i,n):'I can help you with:\n\nüí° **"What were my biggest mistakes?"** - Detailed error analysis\nüìä **"Was my build optimal?"** - Item build review\nüéØ **"Give me pro tips"** - Champion-specific advice\nüîÑ **"Show me similar pro games"** - Learn from the best\n‚¨ÜÔ∏è **"How can I climb faster?"** - Ranking strategies\n\nWhat would you like to know?'}(a.content,s,t);return e({success:!0,response:o})}catch(i){return e({error:"Failed to generate response",details:i.message},{status:500})}}export{n as POST};
