import{json as i}from"@sveltejs/kit";async function e({request:e}){try{const{match:a,participant:s,summonerPuuid:t}=await e.json();if(!a||!s)return i({error:"Missing match data"},{status:400});const n=function(i,e){const a=i.info.gameDuration/60,s=e.win,t=(e.totalMinionsKilled+e.neutralMinionsKilled)/a,n=e.goldEarned/a,o=e.totalDamageDealtToChampions/a,l=e.visionScore/a,r=(e.kills+e.assists)/Math.max(e.deaths,1),u=i.info.participants.filter(i=>i.teamId===e.teamId).reduce((i,e)=>i+e.kills,0),d=u>0?(e.kills+e.assists)/u*100:0,p=[e.item0,e.item1,e.item2,e.item3,e.item4,e.item5,e.item6].filter(i=>0!==i);return{champion:e.championName,role:e.teamPosition||e.individualPosition,win:s,duration:Math.round(a),gameMode:i.info.gameMode,kills:e.kills,deaths:e.deaths,assists:e.assists,kda:r.toFixed(2),killParticipation:d.toFixed(1),cs:e.totalMinionsKilled+e.neutralMinionsKilled,csPerMin:t.toFixed(1),neutralMinionsKilled:e.neutralMinionsKilled,goldEarned:e.goldEarned,goldPerMin:Math.round(n),totalDamage:e.totalDamageDealtToChampions,damagePerMin:Math.round(o),damageShare:0,visionScore:e.visionScore,visionPerMin:l.toFixed(1),wardsPlaced:e.wardsPlaced,wardsKilled:e.wardsKilled,controlWardsPlaced:e.detectorWardsPlaced,largestMultiKill:e.largestMultiKill,largestKillingSpree:e.largestKillingSpree,doubleKills:e.doubleKills,tripleKills:e.tripleKills,quadraKills:e.quadraKills,pentaKills:e.pentaKills,dragonKills:e.dragonKills||0,baronKills:e.baronKills||0,turretKills:e.turretKills||0,items:p,summoner1:e.summoner1Id,summoner2:e.summoner2Id,totalTimeCCDealt:e.totalTimeCCDealt,totalHeal:e.totalHeal,damageSelfMitigated:e.damageSelfMitigated}}(a,s),o=await async function(i){const e=[],a=i.win?"Victory":"Defeat",s=i.win?"ðŸŽ‰":"ðŸ’ª";e.push(`${s} **Match Summary**\n`),e.push(`You played **${i.champion}** as ${i.role} and achieved a **${a}** in ${i.duration} minutes.\n`),e.push(`Final KDA: **${i.kills}/${i.deaths}/${i.assists}** (${i.kda} KDA ratio)\n\n`),e.push("ðŸ“Š **Performance Analysis**\n\n");const t=[];parseFloat(i.kda)>=4&&t.push(`Excellent KDA of ${i.kda}! You dominated this game.`),parseFloat(i.csPerMin)>=7&&t.push(`Outstanding farming with ${i.csPerMin} CS/min!`),parseFloat(i.visionPerMin)>=2&&t.push(`Great vision control (${i.visionScore} vision score).`),parseFloat(i.killParticipation)>=70&&t.push(`High kill participation (${i.killParticipation}%) - you were everywhere!`),i.pentaKills>0?t.push("ðŸ”¥ PENTAKILL! That's legendary!"):i.quadraKills>0?t.push("Amazing Quadra Kill!"):i.tripleKills>0&&t.push("Nice Triple Kill!"),t.length>0&&(e.push("**âœ… What You Did Well:**\n"),t.forEach(i=>e.push(`â€¢ ${i}\n`)),e.push("\n"));const n=[];return i.deaths>=7?n.push(`Too many deaths (${i.deaths}). Focus on positioning and map awareness.`):i.deaths>=5&&n.push(`Death count (${i.deaths}) could be lower. Try to die less than 4 times per game.`),parseFloat(i.csPerMin)<5.5&&n.push(`CS/min is ${i.csPerMin}. Aim for 6-7+ CS/min for better gold income.`),parseFloat(i.visionPerMin)<1.2&&n.push(`Low vision score (${i.visionScore}). Buy more Control Wards and place wards strategically.`),i.wardsKilled<3&&n.push(`Only ${i.wardsKilled} wards cleared. Deny enemy vision more!`),parseFloat(i.killParticipation)<50&&n.push(`Kill participation is ${i.killParticipation}%. Try to be more involved in team fights.`),n.length>0&&(e.push("**ðŸ“ˆ Areas to Improve:**\n"),n.forEach(i=>e.push(`â€¢ ${i}\n`)),e.push("\n")),e.push(`**ðŸ’¡ Pro Tips for ${i.champion}:**\n`),e.push(function(i,e){const a=[];return"JUNGLE"===e.role?(a.push("â€¢ As a jungler, aim for **60+ CS and 70+ vision score** by 20 minutes."),a.push("â€¢ Secure **2+ dragons** and contest Baron when ahead."),a.push("â€¢ Gank lanes with CC or low mobility enemies.")):"SUPPORT"===e.role?(a.push("â€¢ As support, prioritize **80+ vision score** over kills."),a.push("â€¢ Always buy **2+ Control Wards** per back."),a.push("â€¢ Roam mid after level 6 to create pressure.")):"TOP"===e.role||"MIDDLE"===e.role?(a.push("â€¢ Aim for **8+ CS/min** in lane."),a.push("â€¢ Ward at **1:25** to spot jungle invades."),a.push("â€¢ Push wave before backing to deny CS.")):"BOTTOM"===e.role&&(a.push("â€¢ As ADC, prioritize **9+ CS/min** and **low deaths**."),a.push("â€¢ Position in backline during teamfights."),a.push("â€¢ Build Grievous Wounds against healing champs.")),a.push(`â€¢ *${i}-specific tips coming soon!*`),a.join("\n")}(i.champion,i)),e.push("\n\n"),i.win?e.push("**ðŸŽ¯ Keep it up!** You played well in this match. Focus on consistency to climb higher!\n"):e.push("**ðŸ’ª Don't give up!** Every game is a learning opportunity. Review your mistakes and come back stronger!\n"),e.push(`\n*Want specific advice? Ask me about your build, key mistakes, or how pros play ${i.champion}!*`),e.join("")}(n);return i({success:!0,analysis:o,stats:n})}catch(a){return i({error:"Failed to analyze match",details:a.message},{status:500})}}export{e as POST};
