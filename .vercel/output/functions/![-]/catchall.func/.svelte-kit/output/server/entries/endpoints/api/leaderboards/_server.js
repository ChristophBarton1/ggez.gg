import{json as e}from"@sveltejs/kit";const a="RGAPI-f36f4b7f-33dc-4e2d-b226-ef1d6e8b8bce",t={euw:{platform:"euw1",routing:"europe",regional:"europe"},eune:{platform:"eun1",routing:"europe",regional:"europe"},na:{platform:"na1",routing:"americas",regional:"americas"},br:{platform:"br1",routing:"americas",regional:"americas"},lan:{platform:"la1",routing:"americas",regional:"americas"},las:{platform:"la2",routing:"americas",regional:"americas"},kr:{platform:"kr",routing:"asia",regional:"asia"},jp:{platform:"jp1",routing:"asia",regional:"asia"},oce:{platform:"oc1",routing:"sea",regional:"sea"},tr:{platform:"tr1",routing:"europe",regional:"europe"}};async function r({url:r}){const o=r.searchParams.get("region")||"euw",n=r.searchParams.get("role")||"all",s=r.searchParams.get("timeframe")||"7d",{platform:i,regional:l}=t[o]||t.euw;try{const[t,r,m]=await Promise.all([fetch(`https://${i}.api.riotgames.com/lol/league/v4/challengerleagues/by-queue/RANKED_SOLO_5x5?api_key=${a}`),fetch(`https://${i}.api.riotgames.com/lol/league/v4/grandmasterleagues/by-queue/RANKED_SOLO_5x5?api_key=${a}`),fetch(`https://${i}.api.riotgames.com/lol/league/v4/masterleagues/by-queue/RANKED_SOLO_5x5?api_key=${a}`)]);if(!t.ok||!r.ok||!m.ok){const e=[];throw t.ok||e.push(`Challenger: ${t.status} ${t.statusText}`),r.ok||e.push(`Grandmaster: ${r.status} ${r.statusText}`),m.ok||e.push(`Master: ${m.status} ${m.statusText}`),new Error(`Failed to fetch ladder data: ${e.join(", ")}`)}const u=await t.json(),p=await r.json(),g=await m.json();let h=[...u.entries.map(e=>({...e,tier:"Challenger"})),...p.entries.map(e=>({...e,tier:"Grandmaster"})),...g.entries.slice(0,100).map(e=>({...e,tier:"Master"}))];h.sort((e,a)=>a.leaguePoints-e.leaguePoints),h=h.slice(0,10);const c=["157","238","84","777","141","555","11","64","103","245"],f=h.map(async(e,t)=>{try{const n=await fetch(`https://${i}.api.riotgames.com/lol/summoner/v4/summoners/${e.summonerId}?api_key=${a}`);if(!n.ok)throw new Error("Failed to fetch summoner");const s=await n.json();let m=e.summonerName||s.name||`Player${t+1}`,u=o.toUpperCase();try{const e=await fetch(`https://${l}.api.riotgames.com/riot/account/v1/accounts/by-puuid/${s.puuid}?api_key=${a}`);if(e.ok){const a=await e.json();m=a.gameName||m,u=a.tagLine||u}}catch(r){}return{rank:t+1,summonerName:m,tagLine:u,tier:e.tier,lp:e.leaguePoints,flexTier:"Unranked",flexLP:0,lpGain:e.hotStreak?Math.floor(200*Math.random())+100:Math.floor(100*Math.random()),winRate:(e.wins/(e.wins+e.losses)*100).toFixed(1),wins:e.wins,losses:e.losses,mainChampion:c[t%c.length],topChampions:[c[t%c.length],c[(t+1)%c.length],c[(t+2)%c.length],c[(t+3)%c.length],c[(t+4)%c.length]],profileIconId:s.profileIconId||29,summonerId:e.summonerId,puuid:s.puuid}}catch(n){return{rank:t+1,summonerName:e.summonerName||`Player${t+1}`,tagLine:o.toUpperCase(),tier:e.tier,lp:e.leaguePoints,flexTier:"Unranked",flexLP:0,lpGain:e.hotStreak?150:75,winRate:(e.wins/(e.wins+e.losses)*100).toFixed(1),wins:e.wins,losses:e.losses,mainChampion:c[t%c.length],topChampions:[c[t%c.length],c[(t+1)%c.length],c[(t+2)%c.length],c[(t+3)%c.length],c[(t+4)%c.length]],profileIconId:29,summonerId:e.summonerId}}}),d=await Promise.all(f);return e({success:!0,players:d,filters:{region:o,role:n,timeframe:s}})}catch(m){const a=[],t=["Challenger","Grandmaster","Master"],r=["Faker","Caps","Jankos","Rekkles","Perkz","Hans Sama","Upset","Elyoya","Humanoid","Comp"],i=["157","238","84","777","141","555","11","64","103","245"];for(let e=0;e<10;e++)a.push({rank:e+1,summonerName:e<5?r[e]:`Player${e+1}`,tagLine:`${o.toUpperCase()}`,tier:t[Math.floor(e/20)]||"Master",lp:1200-15*e,flexTier:"Unranked",flexLP:0,lpGain:Math.floor(200*Math.random()),winRate:(55+15*Math.random()).toFixed(1),wins:Math.floor(100+400*Math.random()),losses:Math.floor(50+200*Math.random()),mainChampion:i[e%i.length],topChampions:[i[e%i.length],i[(e+1)%i.length],i[(e+2)%i.length],i[(e+3)%i.length],i[(e+4)%i.length]],profileIconId:29});return e({success:!0,players:a,filters:{region:o,role:n,timeframe:s},note:"Using fallback data - Riot API unavailable"})}}export{r as GET};
