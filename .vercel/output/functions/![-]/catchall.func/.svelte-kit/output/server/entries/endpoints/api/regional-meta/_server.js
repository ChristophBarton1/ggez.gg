import{json as a}from"@sveltejs/kit";async function e({url:e}){const t=e.searchParams.get("regions"),n=t?t.split(","):["euw","kr"],s=e.searchParams.get("rank")||"platinum_plus",i=e.searchParams.get("role")||"all",r=e.searchParams.get("queue")||"ranked_solo",c=e.searchParams.get("patch")||"current";try{const e=n.map(a=>fetch(`http://localhost:5173/api/champions-meta?region=${a}&rank=${s}&role=${i}&queue=${r}&patch=${c}`).then(a=>a.json()).then(e=>({region:a,data:e.success?e.champions:[]})).catch(()=>({region:a,data:[]}))),t=await Promise.all(e),o={};t.forEach(({region:a,data:e})=>{o[a]=e});const h=[];if(n.length>=2){const a=n[0],e=n[1],t=o[a]||[],s=o[e]||[],i=new Map(s.map(a=>[a.championId,a]));t.forEach(t=>{const n=i.get(t.championId);if(n){const s=t.winRate-n.winRate,i=t.pickRate-n.pickRate,r=t.banRate-n.banRate;(Math.abs(s)>1.5||Math.abs(i)>3||Math.abs(r)>3)&&h.push({championId:t.championId,tier:t.tier,name:t.name||"Unknown",[a]:{winRate:t.winRate,pickRate:t.pickRate,banRate:t.banRate,games:t.games,tier:t.tier},[e]:{winRate:n.winRate,pickRate:n.pickRate,banRate:n.banRate,games:n.games,tier:n.tier},winRateDiff:s,pickRateDiff:i,banRateDiff:r,totalDiff:Math.abs(s)+Math.abs(i)+Math.abs(r)})}}),h.sort((a,e)=>e.totalDiff-a.totalDiff)}return a({success:!0,regionData:o,differences:h.slice(0,30),filters:{regions:n,rank:s,role:i,queue:r,patch:c},comparisonRegions:n.length>=2?[n[0],n[1]]:[]})}catch(o){return a({success:!1,error:o.message,regionData:{},differences:[]},{status:500})}}export{e as GET};
